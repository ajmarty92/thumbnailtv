'use client'

import { useAuth } from '@/contexts/AuthContext'
import Navigation from '@/components/Navigation'
import TVOptimizationSuite from '@/components/TVOptimizationSuite'
import { useState, useEffect } from 'react'
import { Tv, Zap, TrendingUp, Check, Star, ArrowRight, Play, Users, Shield, Sparkles, ChevronUp, Mail, Lock, Crown, Building, ChevronDown } from 'lucide-react'
import { useRouter } from 'next/navigation'

export default function HomePage() {
  const { user, isLoading, showAuthModal } = useAuth()
  const router = useRouter()
  const [showDemo, setShowDemo] = useState(false)
  const [showScrollTop, setShowScrollTop] = useState(false)
  const [email, setEmail] = useState('')
  const [newsletterStatus, setNewsletterStatus] = useState<'idle' | 'loading' | 'success' | 'error'>('idle')
  const [userPlan, setUserPlan] = useState<'free' | 'starter' | 'pro' | 'manager'>('free')
  const [expandedFAQ, setExpandedFAQ] = useState<number | null>(null) // NEW STATE for enhanced FAQ

  // Scroll to top button visibility
  useEffect(() => {
    const handleScroll = () => {
      setShowScrollTop(window.scrollY > 400)
    }
    window.addEventListener('scroll', handleScroll)
    return () => window.removeEventListener('scroll', handleScroll)
  }, [])

  const scrollToTop = () => {
    window.scrollTo({ top: 0, behavior: 'smooth' })
  }

  const handleNewsletterSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setNewsletterStatus('loading')
    
    // Simulate API call
    setTimeout(() => {
      setNewsletterStatus('success')
      setEmail('')
      setTimeout(() => setNewsletterStatus('idle'), 3000)
    }, 1000)
  }

  const handleStartFreeTrial = () => {
    console.log('Start Free Trial clicked')
    if (user) {
      // User is already logged in, redirect to dashboard or pricing
      router.push('/#pricing')
    } else {
      // Show auth modal for new users
      showAuthModal()
    }
  }

  // Feature Gate Component
  const FeatureGate = ({ 
    children, 
    requiredPlan, 
    fallback 
  }: { 
    children: React.ReactNode
    requiredPlan: 'free' | 'starter' | 'pro' | 'manager'
    fallback: React.ReactNode 
  }) => {
    const planHierarchy = { free: 0, starter: 1, pro: 2, manager: 3 }
    const userLevel = planHierarchy[userPlan]
    const requiredLevel = planHierarchy[requiredPlan]
    
    if (userLevel >= requiredLevel) {
      return <>{children}</>
    }
    return <>{fallback}</>
  }

  const handleUpgradeClick = (plan: 'starter' | 'pro' | 'manager') => {
    // Scroll to pricing section
    document.getElementById('pricing')?.scrollIntoView({ behavior: 'smooth' })
  }

  const handlePlanSelection = (plan: 'starter' | 'pro' | 'manager') => {
    setUserPlan(plan)
    // Optional: You could add a success notification here
  }

  return (
    <div className="min-h-screen bg-gray-900">
      <Navigation />

      <main className="pt-24 px-4 sm:px-6 lg:px-8">
        <div className="max-w-7xl mx-auto">
          {/* Show TV Demo when user clicks the demo button */}
          {user && showDemo ? (
            <TVOptimizationSuite />
          ) : (
            <>
              {/* Hero Section */}
              <div className="text-center mb-20">
                <div className="flex justify-center mb-6">
                  <div className="px-4 py-2 bg-purple-600/10 border border-purple-500/20 rounded-full">
