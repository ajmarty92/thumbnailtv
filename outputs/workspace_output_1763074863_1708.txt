'use client'

import { useState, useCallback, useEffect } from 'react'
import { Upload, Download, Eye, EyeOff, Settings, AlertCircle, CheckCircle, Sparkles, Wand2, Monitor, Layers } from 'lucide-react'
import SmartLoopCompressor from './ai/SmartLoopCompressor'
import LetsEnhanceUpscaler from './ai/LetsEnhanceUpscaler'

export default function TVOptimizationSuite() {
  const [uploadedImage, setUploadedImage] = useState<string | null>(null)
  const [selectedPlatform, setSelectedPlatform] = useState('all')
  const [showGrid, setShowGrid] = useState(true)
  const [isProcessing, setIsProcessing] = useState(false)
  const [processingStage, setProcessingStage] = useState('')
  const [compressionProgress, setCompressionProgress] = useState(0)
  const [originalSize, setOriginalSize] = useState(0)
  const [compressedSize, setCompressedSize] = useState(0)
  const [tvSize, setTvSize] = useState('65')
  const [viewDistance, setViewDistance] = useState('10')
  const [activeDemo, setActiveDemo] = useState<'tv-preview' | 'smart-compression' | 'thumbnail-upscale'>('tv-preview')

  // TV platforms with accurate UI overlays - FIXED TYPES
  const tvPlatforms = [
    {
      id: 'google-tv',
      name: 'Google TV',
      brandColor: 'from-blue-600 to-blue-700',
      uiOverlay: {
        top: 15, // number instead of string
        bottom: 25, // number instead of string
        left: 5,
        right: 5
      }
    },
    {
      id: 'roku',
      name: 'Roku',
      brandColor: 'from-purple-600 to-purple-700',
      uiOverlay: {
        top: 12, // number instead of string
        bottom: 20, // number instead of string
        left: 3,
        right: 3
      }
    },
    {
      id: 'samsung',
      name: 'Samsung TV',
      brandColor: 'from-indigo-600 to-indigo-700',
      uiOverlay: {
        top: 10, // number instead of string
        bottom: 18, // number instead of string
        left: 4,
        right: 4
      }
    },
    {
      id: 'lg-webos',
      name: 'LG webOS',
      brandColor: 'from-pink-600 to-pink-700',
      uiOverlay: {
        top: 8, // number instead of string
        bottom: 15, // number instead of string
        left: 6,
        right: 6
      }
    },
    {
      id: 'apple-tv',
      name: 'Apple TV',
      brandColor: 'from-gray-600 to-gray-700',
      uiOverlay: {
        top: 10, // number instead of string
        bottom: 15, // number instead of string
        left: 2,
        right: 2
      }
    }
  ]

  const handleImageUpload = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {
    const file = event.target.files?.[0]
    if (!file) return

    const reader = new FileReader()
    reader.onload = (e) => {
      const result = e.target?.result as string
      setUploadedImage(result)
      setOriginalSize(file.size)
      setCompressedSize(0)
      setCompressionProgress(0)
    }
    reader.readAsDataURL(file)
  }, [])

  const simulateProcessing = async () => {
    setIsProcessing(true)
    setProcessingStage('Analyzing image...')
    
    const stages = [
      { message: 'Analyzing image...', duration: 500 },
